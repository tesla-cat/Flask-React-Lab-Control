(this["webpackJsonpmonitor-your-lab"]=this["webpackJsonpmonitor-your-lab"]||[]).push([[0],{17:function(e,t,n){"use strict";n.r(t),n.d(t,"auth",(function(){return r})),n.d(t,"fire",(function(){return o})),n.d(t,"signUp",(function(){return l})),n.d(t,"passwordReset",(function(){return u})),n.d(t,"get",(function(){return s})),n.d(t,"getExperiments",(function(){return d})),n.d(t,"getOffers",(function(){return f})),n.d(t,"getDocs",(function(){return m})),n.d(t,"del",(function(){return p})),n.d(t,"delExperiment",(function(){return b})),n.d(t,"delOffer",(function(){return v})),n.d(t,"saveSettings",(function(){return g})),n.d(t,"saveDocPage",(function(){return E})),n.d(t,"getDocTree",(function(){return h}));var a=n(202);n(203),n(205),n(258),a.initializeApp({apiKey:"AIzaSyAiMSvhJ1Ce3Wf_xxXBFEhyGTf0fAJg-Q0",authDomain:"lab-kitten.firebaseapp.com",databaseURL:"https://lab-kitten.firebaseio.com",projectId:"lab-kitten",storageBucket:"lab-kitten.appspot.com",messagingSenderId:"247443746356",appId:"1:247443746356:web:11bae44b3f5a4e7fb96461",measurementId:"G-RXHZK2D1LD"});var r=a.auth,o=a.firestore,i=a.storage;function c(e){var t=e.split("@")[1];return!(!t||!t.includes("edu"))||(alert("please enter an edu email"),!1)}function l(e){var t=e.email,n=e.password;c(t)&&r().createUserWithEmailAndPassword(t,n).then((function(e){r().currentUser.sendEmailVerification().then((function(){return alert("verification email sent, retry after verification")})).then((function(){return r().signOut()}))})).catch((function(e){var a=e.code;"auth/email-already-in-use"==a?function(e,t){r().signInWithEmailAndPassword(e,t).then((function(e){r().currentUser.emailVerified||(alert("retry after email verification"),r().signOut())})).catch((function(e){var t=e.code;alert(t),console.log(t)}))}(t,n):(alert(a),console.log(a))}))}function u(e){var t=e.email;c(t)&&r().sendPasswordResetEmail(t).then((function(){return alert("password reset email sent")}))}function s(e,t,n,a){o().collection(e).where(t,"==",n).onSnapshot((function(e){var t={};e.forEach((function(e){e.exists&&(t[e.id]=e.data())})),a(t)}))}function d(e){s("experiments","uid",r().currentUser.uid,e)}function f(e,t){s("WebRTCforExperiments","expId",e,t)}function m(e){!function(e,t,n,a){o().collection(e).where(t,"array-contains",n).onSnapshot((function(e){var t={};e.forEach((function(e){e.exists&&(t[e.id]=e.data())})),a(t)}))}("docs","collaborators",r().currentUser.email,e)}function h(e,t){o().collection("docs").doc(e.id).collection("children").onSnapshot((function(e){var n={};e.forEach((function(e){var t=e.data().path;n=function(e,t,n){var a=e;return t.map((function(e,r){r<t.length-1?(a[e]=a[e]||{},a=a[e]):a[e]=n})),e}(n,t.split("/"),e.id)})),t(n)}))}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=o().collection(e).doc(t);return Promise.all(n.map((function(n){return a.collection(n).get().then((function(a){var r=[];return a.forEach((function(e){r.push(e.ref.delete())})),console.log(["@firebase.del",r.length,"deleted from",e,t,n].join("\n")),Promise.all(r)}))}))).then((function(){return a.delete()}))}function b(e){return p("experiments",e)}function v(e){return p("WebRTCforExperiments",e,["signal"])}function g(e,t){if(Object.values(t).every((function(e){return e}))){var n=t.title,a=t.collaborators,i=t.uid;a=a.split("\n").map((function(e){return e.trim()}));var c=r().currentUser.email;a.includes(c)||a.push(c);var l=e?o().collection("docs").doc(e):o().collection("docs").doc();return l.set({title:n,collaborators:a,uid:i}),l.id}}function E(e,t,n){var a=t.path;if(a){var c=o().collection("docPages"),l=o().collection("docs").doc(e.id).collection("children"),u=e.childId?c.doc(e.childId):c.doc();Promise.all(n.ops.map((function(e,t){var n=e.insert.image;return n&&n.startsWith("data")?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png";return fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],t,{type:n})}))}(n,"hi").then((function(n){var a=i().ref(["userFiles",r().currentUser.uid,u.id+t].join("/"));return a.put(n).then((function(t){return a.getDownloadURL().then((function(t){return e.insert.image=t,e}))}))})):e}))).then((function(e){u.set({delta:JSON.stringify({delta:e}),path:a}),console.log(u.id),l.doc(u.id).set({path:a})}))}else alert("please specify a path")}},186:function(e,t,n){e.exports=n(257)},225:function(e,t,n){"use strict";n.r(t),n.d(t,"WebRTC",(function(){return u})),n.d(t,"offerWebRTC",(function(){return s}));var a=n(24),r=n(15),o=n(21),i=n(17),c=i.fire,l=i.auth,u=function(){function e(t){var n=this,a=t.role,o=t.docId,i=t.data,l=t.collection;Object(r.a)(this,e),this.role=a,this.remoteRole="offerer"===a?"answerer":"offerer",this.collection=l||"WebRTC",this.col=c().collection(this.collection),o&&(this.doc=this.col.doc(o)),this.data=i,"offerer"===this.role?this.doc?this.initOfferer():this.col.add(this.data).then((function(e){n.doc=e,n.initOfferer()})):this.initAnswerer()}return Object(o.a)(e,[{key:"initOfferer",value:function(){var e=this;this.db=this.doc.collection("signal"),this.deleteDB().then((function(){e.initPeer(),e.listenDescription(),e.makeChannel(),e.makeDescription()}))}},{key:"initAnswerer",value:function(){this.db=this.doc.collection("signal"),this.listenDescription()}},{key:"send",value:function(e){this.localChannel&&"open"===this.localChannel.readyState?this.localChannel.send(e):this.remoteChannel&&"open"===this.remoteChannel.readyState&&this.remoteChannel.send(e)}},{key:"deleteDB",value:function(){var e=this;return this.db.get().then((function(t){var n=[];return t.forEach((function(e){return n.push(e.ref.delete())})),console.log(["@WebRTC.deleteDB",n.length,"deleted from",e.collection,e.doc.id,"signal"].join("\n")),Promise.all(n)}))}},{key:"makeChannel",value:function(){var e=this;this.localChannel=this.peer.createDataChannel(this.role),this.localChannel.onopen=function(t){return e.log("local channel opened")},this.localChannel.onmessage=this.onMessage}},{key:"makeDescription",value:function(){var e=this;("offerer"===this.role?this.peer.createOffer():this.peer.createAnswer()).then((function(t){e.peer.setLocalDescription(t).then((function(){var n=t.type,a=t.sdp;e.db.doc(e.role).set({type:n,sdp:a})}))}))}},{key:"listenDescription",value:function(){var e=this;this.db.doc(this.remoteRole).onSnapshot((function(t){t.exists&&("answerer"===e.role&&e.initPeer(),e.peer.setRemoteDescription(new RTCSessionDescription(t.data())).then((function(){e.log("remote description set"),"answerer"===e.role&&e.makeDescription()})).catch((function(t){return e.log(">> ERROR set description ".concat(t))})))}))}},{key:"initPeer",value:function(){this.peer=new RTCPeerConnection,this.listenLocalEvent(),this.listenRemoteEvent()}},{key:"listenLocalEvent",value:function(){var e=this;this.peer.onicecandidate=function(t){if(t.candidate){var n=t.candidate,a=n.candidate,r=n.sdpMid,o=n.sdpMLineIndex;e.db.doc(e.role+"ICE").set({candidate:a,sdpMid:r,sdpMLineIndex:o})}},this.peer.ondatachannel=function(t){e.remoteChannel=t.channel,e.remoteChannel.onopen=function(t){return e.log("remote channel opened")},e.remoteChannel.onmessage=e.onMessage}}},{key:"listenRemoteEvent",value:function(){var e=this;this.db.doc(this.remoteRole+"ICE").onSnapshot((function(t){t.exists&&e.peer.addIceCandidate(new RTCIceCandidate(t.data())).then((function(){e.log("remote ice set")})).catch((function(t){return e.log(">> ERROR set ice ".concat(t))}))}))}},{key:"log",value:function(e){console.log(this.role,e)}},{key:"destroy",value:function(){for(var e=this;!this.doc;);return this.deleteDB().then((function(){return e.doc.delete()}))}}]),e}();function s(e,t){var n=l().currentUser.uid;return new u({role:"offerer",data:Object(a.a)({expId:e,uid:n},t),collection:"WebRTCforExperiments"})}},257:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(90),i=n.n(o),c=n(11),l=n(150),u=n(268),s=n(267),d=n(24),f=n(2),m=n(262),h=n(10),p=n(122),b=n(263),v=n(180),g=n(181),E=function(e){var t=e.children,n=e.p,a=e.on,o=e.n;return r.a.createElement(m.a,{style:[{outline:"none",fontSize:18,fontWeight:"bold",color:"blue",textAlign:"center",alignSelf:"center",padding:4,margin:6},o>1?O.multiLine:O.oneLine],value:t,placeholder:n,onChangeText:a,numberOfLines:o,multiline:o>1})},O=h.a.create({oneLine:{borderBottomWidth:3,borderBottomColor:"skyblue"},multiLine:{borderWidth:3,borderColor:"skyblue",borderRadius:30}}),y=function(e){var t=e.children,n=e.c;return r.a.createElement(p.a,{style:{fontSize:16,fontWeight:"bold",color:n}},t)},j=function(e){var t=e.children,n=e.on,a=e.c,o=void 0===a?"white":a,i=e.bg,c=void 0===i?"grey":i;return r.a.createElement(b.a,{style:{backgroundColor:c,margin:10,paddingHorizontal:20,paddingVertical:5,borderRadius:30,justifyContent:"center",alignItems:"center"},onPress:n},r.a.createElement(y,{c:o},t))},x="https://raw.githubusercontent.com/lab-kitten/lab-kitten/master/images/icons/";var C=function(e){var t,n=e.children,a=e.s,o=void 0===a?25:a;return r.a.createElement(c.a,{style:{height:o,width:o,padding:3}},r.a.createElement(v.a,{style:{flex:1},resizeMode:"contain",source:{uri:(t=n,[x,t,".svg"].join(""))}}))},w=function(e){var t=e.children,n=e.on,a=e.s;return r.a.createElement(b.a,{onPress:n},r.a.createElement(C,{s:a},t))},k=function(e){var t=e.children,n=e.style;return r.a.createElement(c.a,{style:[{backgroundColor:"white",flex:1,justifyContent:"center"},n]},t)},S=function(e){var t=e.children,n=e.style;return r.a.createElement(c.a,{style:[{flexDirection:"row",justifyContent:"space-evenly",alignItems:"center",flexWrap:"wrap"},n]},t)},R=function(e){var t=e.children,n=e.f,a=e.h,o=e.w;return r.a.createElement(c.a,{style:{flex:n,height:a,width:o}},t)},D=function(e){var t=e.children,n=e.Card;return r.a.createElement(g.a,{data:Object.entries(t),keyExtractor:function(e){return e[0]},renderItem:function(e){var t=e.item,a=e.index;return r.a.createElement(n,{id:t[0],data:t[1],index:a})}})},I=n(17),W=I.auth,T=I.signUp,U=I.passwordReset;function P(){var e=Object(a.useState)({email:"",password:""}),t=Object(f.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(),c=Object(f.a)(i,2),l=c[0],u=c[1];function s(e){o(Object.assign(Object(d.a)({},n),e))}return Object(a.useEffect)((function(){W().onAuthStateChanged((function(){u(W().currentUser)}))}),[]),l?r.a.createElement(k,null,r.a.createElement(S,null,r.a.createElement(y,{c:"blue"},"signed in as: ",l.email)),r.a.createElement(R,{h:60}),r.a.createElement(S,null,r.a.createElement(j,{on:function(){return U(l)}},"reset password"),r.a.createElement(j,{on:function(){return W().signOut()}},"sign out"))):r.a.createElement(k,null,r.a.createElement(E,{p:"email",on:function(e){return s({email:e})}},n.email),r.a.createElement(E,{p:"password",on:function(e){return s({password:e})}},n.password),r.a.createElement(R,{h:60}),r.a.createElement(S,null,r.a.createElement(j,{on:function(){return U(n)}},"forgot password"),r.a.createElement(j,{on:function(){return T(n)}},"sign up / sign in")))}var L=n(4),A=n(17);var B=h.a.create({card:{maxWidth:"100vw",backgroundColor:"azure",margin:10,borderRadius:30,overflow:"hidden",paddingHorizontal:20,paddingVertical:10}});function z(e){var t=e.id,n=e.data,a=e.index,o=Object(L.useNavigation)();return r.a.createElement(c.a,{style:[{},B.card]},r.a.createElement(S,{style:{flex:1}},r.a.createElement(w,{on:function(){return Object(A.delExperiment)(t)}},"delete"),r.a.createElement(c.a,{style:{flex:1,paddingHorizontal:10}},r.a.createElement(y,null,[a+1,n.experimentName].join(". "))),r.a.createElement(w,{on:function(){return o.navigate("Connection",{id:t,data:n})}},"next")))}function M(e){var t=e.id,n=e.data,a=e.index;Object(L.useNavigation)();return r.a.createElement(c.a,{style:[{},B.card]},r.a.createElement(S,{style:{flex:1}},r.a.createElement(w,{on:function(){return Object(A.delOffer)(t)}},"delete"),r.a.createElement(c.a,{style:{flex:1,paddingHorizontal:10}},r.a.createElement(y,null,[a+1,n.info].join(". ")))))}function N(){var e=Object(L.useRoute)().params,t=Object(a.useState)({}),n=Object(f.a)(t,2),o=n[0],i=n[1];return Object(a.useEffect)((function(){Object(A.getOffers)(e.id,(function(e){return i(e)}))}),[]),r.a.createElement(k,null,r.a.createElement(S,null,r.a.createElement(j,{on:function(){Object.keys(o).map((function(e){return Object(A.delOffer)(e)}))}},"delete all")),r.a.createElement(D,{Card:M},o))}function H(){var e=Object(L.useNavigation)(),t=Object(a.useState)({}),n=Object(f.a)(t,2),o=n[0],i=n[1];return Object(a.useEffect)((function(){Object(A.auth)().onAuthStateChanged((function(){Object(A.auth)().currentUser?Object(A.getExperiments)((function(e){return i(e)})):e.navigate("SignUp")}))}),[]),r.a.createElement(k,null,r.a.createElement(D,{Card:z},o))}var J=n(65),F=n(264),V=n(170),X=n.n(V),G=n(171),K=n.n(G)()(X.a);function _(e){var t=e.children,n=t.plots,a=t.commonX;return n.map((function(e,t){var n=e.data,o=e.layout;return n.map((function(e,t){"commonX"==e.x&&(n[t].x=a)})),r.a.createElement(K,{key:t,data:n,layout:o})}))}var Q=n(225).offerWebRTC;function Z(){var e=Object(L.useRoute)().params,t=Object(L.useNavigation)(),n=Object(a.useState)(),o=Object(f.a)(n,2),i=o[0],l=o[1],u=Object(a.useState)(),s=Object(f.a)(u,2),m=s[0],h=s[1],p=Object(a.useState)({info:"made by () on device ()"}),b=Object(f.a)(p,2),v=b[0],g=b[1];function O(){var t=Q(e.id,v);t.onMessage=function(e){var t=e.data;h(JSON.parse(t))},l(t)}return Object(a.useEffect)((function(){e&&(h(),i?e.id!=i.data.expId&&i.destroy().then((function(){O()})):O())}),[e]),e?r.a.createElement(k,null,r.a.createElement(J.a,null,r.a.createElement(c.a,{style:B.card},r.a.createElement(S,null,r.a.createElement(c.a,{style:{flex:1}},r.a.createElement(y,null,"a connection to ",e.data.experimentName)),r.a.createElement(w,{on:function(){return t.navigate("Experiment",e)}},"more")),r.a.createElement(S,null,r.a.createElement(S,{style:{flex:1}},r.a.createElement(E,{p:"info",on:function(e){g(Object.assign(Object(d.a)({},v),{info:e}))}},v.info)),r.a.createElement(w,{on:function(){i&&i.doc&&alert("a bug to be fixed: updating the info causes disconnection")}},"check"))),m?r.a.createElement(_,null,m):r.a.createElement(F.a,{size:"large"}))):r.a.createElement(k,null,r.a.createElement(S,null,r.a.createElement(y,null,"please select one experiment")))}n(172);function $(){var e=Object(L.useRoute)().params,t=e.data,n=t.title,o=t.collaborators,i=t.uid;o=o.join("\n");var c=Object(a.useState)({title:n,collaborators:o,uid:i}),l=Object(f.a)(c,2),u=l[0],s=l[1],m=Object(a.useState)(e.id),h=Object(f.a)(m,2),p=h[0],b=h[1];function v(e){s(Object.assign(Object(d.a)({},u),e))}return r.a.createElement(k,null,r.a.createElement(E,{p:"title",on:function(e){return v({title:e})}},u.title),r.a.createElement(R,{h:30}),r.a.createElement(S,null,r.a.createElement(y,null,"collaborators (one per line):")),r.a.createElement(E,{n:10,p:"collaborators",on:function(e){return v({collaborators:e})}},u.collaborators),r.a.createElement(S,null,r.a.createElement(j,{bg:"red",on:function(){alert("TODO: delete")}},"delete"),r.a.createElement(j,{on:function(){return b(Object(A.saveSettings)(p,u))}},"save")))}n(12);var q=n(116),Y=n(173);Object(q.b)({OrbitControls:Y.a});var ee=new WebSocket("ws://localhost:8080");ee.addEventListener("open",(function(e){ee.send("Hello Server!")})),ee.addEventListener("message",(function(e){console.log("Message from server ",e.data)}));var te="lab-kitten",ne=Object(u.a)(),ae=Object(s.a)(),re={SignUp:"authentication",Experiments:"experiment",Connection:"connection",Movies:"movies",Player:"player"};function oe(){return r.a.createElement(ne.Navigator,{screenOptions:function(e){var t=e.route;return{tabBarIcon:function(e){e.focused,e.color,e.size;return r.a.createElement(C,null,re[t.name])}}},tabBarOptions:{activeTintColor:"tomato",inactiveTintColor:"gray"}},r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.Screen,{name:"Experiments",component:H,options:{title:"Experiments"}}),r.a.createElement(ne.Screen,{name:"Connection",component:Z,options:{title:"Connection"}})),void 0,void 0,void 0,r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.Screen,{name:"SignUp",component:P,options:{title:"Auth"}})))}function ie(e){window.open(e,"_blank")}function ce(){return r.a.createElement(S,null,r.a.createElement(w,{s:40,on:function(){return ie("https://github.com/lab-kitten/lab-kitten")}},te),r.a.createElement(R,{w:10}),r.a.createElement(j,{on:function(){return ie("https://github.com/lab-kitten/lab-kitten")}},te),r.a.createElement(R,{f:1}))}function le(){return r.a.createElement(c.a,{style:{height:"100vh",maxWidth:600,margin:"auto"}},r.a.createElement(l.a,null,r.a.createElement(ae.Navigator,{screenOptions:{headerStyle:{height:50}}},r.a.createElement(ae.Screen,{name:"HomeTabs",component:oe,options:{headerTitle:function(e){return r.a.createElement(ce,e)}}}),r.a.createElement(ae.Screen,{name:"Experiment",component:N,options:function(e){return{title:["connections to",e.route.params.data.experimentName].join(" ")}}}),r.a.createElement(ae.Screen,{name:"DocSettings",component:$,options:function(e){return{title:e.route.params?"doc settings":"new doc"}}}))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(le,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[186,1,2]]]);